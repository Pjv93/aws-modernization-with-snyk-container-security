+++
title = "Step 10: Replace Base Image with Chainguard Equivalent"
chapter = false
weight = 41
+++

## Recap on Images

First, let's remind ourselves of the current vulnerability status of the `thumbnailer` image:

```
snyk container test $REPO/thumbnailer --file=Dockerfile --exclude-app-vulns
```

This should show you something like:

```
...
Tested 425 dependencies for known issues, found 326 issues.

Base Image       Vulnerabilities  Severity
python:3.12.0b1  326              6 critical, 14 high, 23 medium, 283 low
...
```

And we can also check the size of the image:

```
docker images $REPO/thumbnailer:latest
```

Which should be similar to:

```
REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
thumbnailer   latest    171a4fbc104f   11 minutes ago   894MB
```

## Changing to a Chainguard Base Image

Now let's try changing the base image to a Chainguard one.

Double click on the `Dockerfile` under the `thumbnailer` directory in your Cloud9 IDE sidebar and change the first line from:
```docker
FROM python:3.12.0b1
```
To:
```docker
FROM cgr.dev/chainguard/python:latest-dev
USER root
RUN apk add imagemagick
```

Also change the CMD on the last line from:

```docker
CMD ["python3","webapp.py"]
```
To:
```docker
CMD ["webapp.py"]
```

Now, rebuild the image:
```bash
docker build -t $REPO/thumbnailer .
```
 ... and let's re-scan it:
```bash
snyk container test $REPO/thumbnailer --file=Dockerfile --exclude-app-vulns
```

The results should show a big reduction in vulnerabilities:
```text
...

âœ” Tested 53 dependencies for known issues, no vulnerable paths found.

Currently, we only offer base image recommendations for Official Docker images
```

The image size should also be significantly reduced. Try running:

```
docker images $REPO/thumbnailer
```

Which give us:

```
REPOSITORY    TAG       IMAGE ID       CREATED       SIZE
thumbnailer   latest    131a66726710   4 hours ago   540MB
```

As before, you can push the image and deploy the application:


```sh
docker push $REPO/thumbnailer:latest
```

Followed by:

```sh
kubectl scale deployment thumbnailer --replicas=0
kubectl scale deployment thumbnailer --replicas=1
```

In this section we've seen how simply changing the base image for a Chainguard one significantly
reduces the vulnerabilities and size of the image.

In the next section we'll see how we can use some advanced techniques to make an even smaller and
more secure image.
